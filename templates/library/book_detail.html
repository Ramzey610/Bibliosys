{% extends 'base.html' %}

{% block title %}{{ book.title }} - Bibliothèque{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'library:dashboard' %}">Accueil</a></li>
        <li class="breadcrumb-item"><a href="{% url 'library:book_list' %}">Livres</a></li>
        <li class="breadcrumb-item active">{{ book.title }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-body">
                <h1>{{ book.title }}</h1>
                <h5 class="text-muted mb-4">par {{ book.author }}</h5>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                        <p><strong>Catégorie:</strong> {{ book.category.name|default:"N/A" }}</p>
                        <p><strong>Langue:</strong> {{ book.language }}</p>
                        <p><strong>Éditeur:</strong> {{ book.publisher|default:"N/A" }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Date de publication:</strong> {{ book.publication_date|date:"d/m/Y"|default:"N/A" }}</p>
                        <p><strong>Exemplaires totaux:</strong> {{ book.total_copies }}</p>
                        <p><strong>Exemplaires disponibles:</strong> 
                            <span class="badge {% if book.is_available %}bg-success{% else %}bg-danger{% endif %}">
                                {{ book.available_copies }}
                            </span>
                        </p>
                        <p><strong>Ajouté le:</strong> {{ book.date_added|date:"d/m/Y" }}</p>
                    </div>
                </div>

                {% if book.description %}
                <div class="mb-4">
                    <h5>Description</h5>
                    <p>{{ book.description }}</p>
                </div>
                {% endif %}

                {% if user.is_staff or user.role == 'admin' %}
                <div class="btn-group" role="group">
                    <a href="{% url 'library:book_update' book.pk %}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                    <a href="{% url 'library:book_delete' book.pk %}" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Supprimer
                    </a>
                </div>
                {% elif user.is_authenticated and user.role == 'lecteur' %}
                <!-- Le lecteur peut créer une demande d'emprunt depuis la page du livre -->
                {% if book.is_available %}
                <a href="{% url 'loans:demande_emprunt' %}?livre={{ book.pk }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Demande d'emprunt
                </a>
                {% else %}
                <a href="#" class="btn btn-secondary disabled" title="Indisponible">Demande d'emprunt</a>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Informations</h5>
            </div>
            <div class="card-body">
                {% if book.is_available %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> 
                        <strong>Disponible!</strong>
                        <br>{{ book.available_copies }} exemplaire(s) en stock
                    </div>
                {% else %}
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle"></i> 
                        <strong>Indisponible</strong>
                        <br>Tous les exemplaires sont empruntés
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <a href="{% url 'library:book_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Retour
        </a>
    </div>
</div>
{% endblock %}
